unit Open_Order;

interface

uses
  Windows, Messages, SysUtils, Classes, Graphics, Controls, Forms, Dialogs,
  ComCtrls, StdCtrls, Grids, DBGrids, ExtCtrls, Mask, DBCtrls, Db, DBClient,
  MConnect, MidasCon,Report;

type
  TOpenOrders = class(TForm)
    PageControl1: TPageControl;
    Sheet1: TTabSheet;
    Sheet2: TTabSheet;
    Panel1: TPanel;
    GroupBox1: TGroupBox;
    DBGrid1: TDBGrid;
    OrderId: TLabel;
    DBText1: TDBText;
    Date: TLabel;
    DBText2: TDBText;
    Label1: TLabel;
    Label2: TLabel;
    Label3: TLabel;
    Label4: TLabel;
    Label5: TLabel;
    Label6: TLabel;
    Label7: TLabel;
    Label8: TLabel;
    Label9: TLabel;
    Label10: TLabel;
    Label11: TLabel;
    Label12: TLabel;
    Label13: TLabel;
    GroupBox2: TGroupBox;
    Label14: TLabel;
    Label15: TLabel;
    Label16: TLabel;
    Label17: TLabel;
    Label18: TLabel;
    Label19: TLabel;
    Label20: TLabel;
    Label21: TLabel;
    Label22: TLabel;
    DBEdit1: TDBEdit;
    DBEdit2: TDBEdit;
    DBText3: TDBText;
    DBText4: TDBText;
    DBText5: TDBText;
    DBText6: TDBText;
    DBText7: TDBText;
    DBText8: TDBText;
    DBText9: TDBText;
    DBText10: TDBText;
    DBText11: TDBText;
    DBText12: TDBText;
    DBText13: TDBText;
    DBText14: TDBText;
    DBText15: TDBText;
    DBText16: TDBText;
    DBText17: TDBText;
    DBText18: TDBText;
    DBText19: TDBText;
    DBText20: TDBText;
    Button1: TButton;
    Button2: TButton;
    GroupBox3: TGroupBox;
    GroupBox4: TGroupBox;
    GroupBox5: TGroupBox;
    Label23: TLabel;
    Label24: TLabel;
    Label25: TLabel;
    Label26: TLabel;
    Label27: TLabel;
    Edit1: TEdit;
    Edit2: TEdit;
    Button5: TButton;
    Edit3: TEdit;
    Button6: TButton;
    DBText21: TDBText;
    Label28: TLabel;
    Label30: TLabel;
    ClientDataSet1: TClientDataSet;
    ClientDataSet2: TClientDataSet;
    DataSource1: TDataSource;
    DataSource2: TDataSource;
    ClientDataSet5: TClientDataSet;
    DataSource5: TDataSource;
    Button4: TButton;
    ClientDataSet1ORDER_ID: TFloatField;
    ClientDataSet1CUSTOMER_ID: TStringField;
    ClientDataSet1ORDER_DATE: TStringField;
    ClientDataSet1SHIP_DATE: TStringField;
    ClientDataSet1SELLER_ID: TStringField;
    ClientDataSet1LINE_ITEM: TDataSetField;
    ClientDataSet2ID: TFloatField;
    ClientDataSet2UPC: TStringField;
    ClientDataSet2DESCRIPTION: TStringField;
    ClientDataSet2PRICE: TFloatField;
    ClientDataSet2QTY: TFloatField;
    ClientDataSet2DISCOUNT: TFloatField;
    ClientDataSet2DISCOUNTBaht: TFloatField;
    ClientDataSet2SUB_TOTAL: TFloatField;
    ClientDataSet5CUSTOMER_ID: TStringField;
    ClientDataSet5FIRST_NAME: TStringField;
    ClientDataSet5LAST_NAME: TStringField;
    ClientDataSet5COMPANY: TStringField;
    ClientDataSet5PERCENT_DISCOUNT: TFloatField;
    ClientDataSet5ADDRESS: TADTField;
    ClientDataSet5ADDRESS_ID: TStringField;
    ClientDataSet5STREET: TStringField;
    ClientDataSet5TAMBOL: TStringField;
    ClientDataSet5AMPHOR: TStringField;
    ClientDataSet5PROVINCE: TStringField;
    ClientDataSet5ZIPCODE: TStringField;
    ClientDataSet5TEL: TStringField;
    ClientDataSet5VIA_TO: TADTField;
    ClientDataSet5ADDRESS_ID2: TStringField;
    ClientDataSet5STREET2: TStringField;
    ClientDataSet5TAMBOL2: TStringField;
    ClientDataSet5AMPHOR2: TStringField;
    ClientDataSet5PROVINCE2: TStringField;
    ClientDataSet5ZIPCODE2: TStringField;
    ClientDataSet5TEL2: TStringField;
    RemoteServer1: TRemoteServer;
    procedure Button1Click(Sender: TObject);
    procedure Button2Click(Sender: TObject);
//poo
    function Total:real;
    procedure MakeLineItem(UPC:string;QTY:integer);
    procedure DelLineItem(ID:integer);
    procedure FormActivate(Sender: TObject);
    procedure Button5Click(Sender: TObject);
    procedure Button6Click(Sender: TObject);
    procedure Button4Click(Sender: TObject);
    procedure FormClose(Sender: TObject; var Action: TCloseAction);

  private
    { Private declarations }
  public
    { Public declarations }
  end;

var
  OpenOrders: TOpenOrders;

implementation

{$R *.DFM}

var Order_ID : integer;

procedure TOpenOrders.Button1Click(Sender: TObject);
begin
     ClientDataSet1.ApplyUpdates(500);
     Self.RemoteServer1.AppServer.endorder;
     Application.Terminate;
end;

procedure TOpenOrders.Button2Click(Sender: TObject);
begin
     ClientDataSet2.ApplyUpdates(500);
     ClientDataSet1.ApplyUpdates(500);
     Self.RemoteServer1.AppServer.endorder;
     Self.Close;
end;

function TOpenOrders.Total:real;
begin
     Result := StrToFloat(RemoteServer1.AppServer.Total);
end;

procedure TOpenOrders.MakeLineItem(UPC:string;QTY:integer);
var ID,KindOf : integer;
    Price,Discount : real;
begin
end;

procedure TOpenOrders.DelLineItem(ID:integer);
var m,n : integer;
begin
end;

procedure TOpenOrders.FormActivate(Sender: TObject);
begin
     Self.RemoteServer1.Connected := true;
     Order_ID := RemoteServer1.AppServer.GetOrderID;
     ClientDataSet1.Refresh;
     ClientDataSet1.SetKey;
     ClientDataSet1.FieldByName('ORDER_ID').AsInteger := Order_ID;
     ClientDataSet1.GotoKey;
     ClientDataSet5.Refresh;
     ClientDataSet2.Open;
end;

procedure TOpenOrders.Button5Click(Sender: TObject);
var Rs,UPC:widestring;
    QTY,OrderID:integer;
begin
     UPC := Self.Edit1.Text;
     QTY := StrToInt(Self.Edit2.Text);
     if (UPC<>'') and (QTY>0) then
     begin
          Rs := RemoteServer1.AppServer.MakeLineItem(UPC,QTY);
          if Rs <> '' then
              showmessage(Rs)
          else
          begin
               OrderID := RemoteServer1.AppServer.GetOrderID;
               ClientDataSet1.Close;
               ClientDataSet1.Open;
               ClientDataSet5.Close;
               ClientDataSet5.Open;
               ClientDataSet1.SetKey;
               ClientDataSet1.FieldByName('ORDER_ID').AsInteger := OrderID;
               ClientDataSet1.GotoKey;
               ClientDataSet2.Open;
          end;
     end;
end;

procedure TOpenOrders.Button6Click(Sender: TObject);
var ID,ID1,n,OrderID,m:integer;
    Rs:widestring;
begin
     ID := StrToInt(EDit3.Text);
     ID1 := ID;
     ClientDataSet2.Close;
     ClientDataSet2.Open;
     if ID>0 then
     begin
          ClientDataSet2.SetKey;
          ClientDataSet2.FieldByName('ID').AsString := Edit3.Text;
          if ClientDataSet2.GotoKey then
          begin
               ClientDataSet2.Delete;
               while not ClientDataSet2.Eof do
               begin
                    ClientDataSet2.Edit;
                    ClientDataSet2.FieldByName('ID').AsInteger := ID;
                    ID:=ID+1;
                    ClientDAtaSet2.Next;
               end;
               ClientDataSet1.ApplyUpdates(500);
               Self.RemoteServer1.AppServer.DelLineItem(ID1);
          end
          else showmessage('ไม่พบรายการสินค้าที่ต้องการ');
     end;
end;

procedure TOpenOrders.Button4Click(Sender: TObject);
var Rs:widestring;
begin
     Rs := Self.RemoteServer1.AppServer.Total;
     Self.Label30.Caption := Rs + '  บาท';
end;

procedure TOpenOrders.FormClose(Sender: TObject; var Action: TCloseAction);
begin
     Self.RemoteServer1.Connected := false;
end;


end.


