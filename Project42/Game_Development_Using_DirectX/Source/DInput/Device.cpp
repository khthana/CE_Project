///////////////////////////////////////////////////////////
//Project Name:	Game developent using DirectX(DirectInput)
//Author:		Tawin Tusnajareon azzuri_man@hotmail.com
//Source File:	Device Implementation
//version 1.0
///////////////////////////////////////////////////////////

#include "DInput.h"

//////////////////////////////////////////////////////////////////////////////////
// CDevice Constructor
//////////////////////////////////////////////////////////////////////////////////
CDevice::CDevice(void)
{
	lpdi2 = NULL;
	m_bActive = FALSE;
}

//////////////////////////////////////////////////////////////////////////////////
// CDevice Destructor
//////////////////////////////////////////////////////////////////////////////////
CDevice::~CDevice(void)
{
	lpdi2->Unacquire();
	RELEASE(lpdi2);
}

//////////////////////////////////////////////////////////////////////////////////
// CDevice Create
//////////////////////////////////////////////////////////////////////////////////
HRESULT CDevice::Create(CInput* input, REFGUID guid)
{
	HRESULT rval;
	LPDIRECTINPUTDEVICE lpDID = NULL;

	// Create the device
	rval = input->GetDI()->CreateDevice(guid, &lpDID, NULL);
	if(rval == DI_OK) m_bActive = TRUE;

	rval = lpDID->QueryInterface(IID_IDirectInputDevice2, (LPVOID*)&lpdi2);
	if(rval != DI_OK) return rval;

	RELEASE(lpDID);

	return rval;
}

//////////////////////////////////////////////////////////////////////////////////
// CDevice SetDateFormat
//////////////////////////////////////////////////////////////////////////////////
HRESULT CDevice::SetDataFormat(LPCDIDATAFORMAT df)
{
	//set data format
	return lpdi2->SetDataFormat(df);
}

//////////////////////////////////////////////////////////////////////////////////
// CDevice SetCooperativeLevel
//////////////////////////////////////////////////////////////////////////////////
HRESULT CDevice::SetCooperativeLevel(void* hwnd, DWORD flags)
{
	//set cooperation level
	return lpdi2->SetCooperativeLevel((HWND) hwnd, flags);
}

//////////////////////////////////////////////////////////////////////////////////
// CDevice RunControlPanel
//////////////////////////////////////////////////////////////////////////////////
HRESULT CDevice::RunControlPanel(void* hwnd)
{
	return lpdi2->RunControlPanel((HWND) hwnd, 0);
}

//////////////////////////////////////////////////////////////////////////////////
// CDevice Acquire
//////////////////////////////////////////////////////////////////////////////////
HRESULT CDevice::Acquire(void)
{
	//acquire device
	return lpdi2->Acquire();
}

//////////////////////////////////////////////////////////////////////////////////
// CDevice Unacquire
//////////////////////////////////////////////////////////////////////////////////
HRESULT CDevice::Unacquire(void)
{
	return lpdi2->Unacquire();
}

//////////////////////////////////////////////////////////////////////////////////
// CDevice SetAbsolute
//////////////////////////////////////////////////////////////////////////////////
HRESULT CDevice::SetAbsolute(void)
{
	DIPROPDWORD dipdw;

	dipdw.diph.dwSize = sizeof(DIPROPDWORD);
	dipdw.diph.dwHeaderSize = sizeof(DIPROPHEADER);
	dipdw.diph.dwObj = 0;
	dipdw.diph.dwHow = DIPH_DEVICE;
	dipdw.dwData = DIPROPAXISMODE_ABS;
	return lpdi2->SetProperty(DIPROP_AXISMODE, &dipdw.diph);
}

//////////////////////////////////////////////////////////////////////////////////
// CDevice SetRelative
//////////////////////////////////////////////////////////////////////////////////
HRESULT CDevice::SetRelative(void)
{
	DIPROPDWORD dipdw;

	dipdw.diph.dwSize = sizeof(DIPROPDWORD);
	dipdw.diph.dwHeaderSize = sizeof(DIPROPHEADER);
	dipdw.diph.dwObj = 0;
	dipdw.diph.dwHow = DIPH_DEVICE;
	dipdw.dwData = DIPROPAXISMODE_REL;
	return lpdi2->SetProperty(DIPROP_AXISMODE, &dipdw.diph);
}
