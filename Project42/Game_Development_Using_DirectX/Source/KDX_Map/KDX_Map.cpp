/////////////////////////////////////////////////////////////////////////////
// File Name:		KDX_Map.cpp
// Author:			Tiwakorn Komut
// Source File:		KDX_Map Implementation
// Date:			31/03/2000
// Comment:
/////////////////////////////////////////////////////////////////////////////
#include "KDX_Map.h"

/////////////////////////////////////////////////////////////////////////////
// KDX_Map Constructor
/////////////////////////////////////////////////////////////////////////////
KDX_Map::KDX_Map (void)
{
	Initialise ();
}

/////////////////////////////////////////////////////////////////////////////
// KDX_Map Destructor
/////////////////////////////////////////////////////////////////////////////
KDX_Map::~KDX_Map (void)
{
	Finalise ();
}

/////////////////////////////////////////////////////////////////////////////
// KDX_Map Initialise
/////////////////////////////////////////////////////////////////////////////
void KDX_Map::Initialise (void)
{
	FillMap (0, 0, MAX_BLOCK - 1, MAX_BLOCK - 1, TYPE_NORMAL, 0, -1);
}

/////////////////////////////////////////////////////////////////////////////
// KDX_Map Finalise
/////////////////////////////////////////////////////////////////////////////
void KDX_Map::Finalise (void)
{

}

/////////////////////////////////////////////////////////////////////////////
// KDX_Map LoadMap
/////////////////////////////////////////////////////////////////////////////
BOOL KDX_Map::LoadMap (char* filename)
{
	int file_handle;
	OFSTRUCT file_data;
	if ((file_handle = OpenFile (filename, &file_data, OF_READ)) == -1)
		return FALSE;

	int i, j;
	FILEBLOCKSTATUS buff;
	for (i = 0; i < MAX_BLOCK; i++)
		for (j = 0; j < MAX_BLOCK; j++)
		{
			_lread (file_handle, &buff, sizeof (FILEBLOCKSTATUS));
			m_Map[i][j].type = (int) buff.type;
			m_Map[i][j].level = (int) buff.level;
			m_Map[i][j].reserved = (int) buff.reserved;
		}

	_lclose (file_handle);
	return TRUE;
}

/////////////////////////////////////////////////////////////////////////////
// KDX_Map FillMap
/////////////////////////////////////////////////////////////////////////////
void KDX_Map::FillMap (int i1, int j1, int i2, int j2, int type, int level, int reserved)
{
	int i, j;
	for (i = i1; i <= i2; i++)
		for (j = j1; j <= j2; j++)
		{
			m_Map[i][j].type = type;
			m_Map[i][j].level = level;
			m_Map[i][j].reserved = reserved;
		}
}